<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calculator — Single File</title>
  <style>
    :root{
      --bg:#0f1724;
      --panel:#111827;
      --accent:#06b6d4;
      --muted:#94a3b8;
      --btn:#1f2937;
      --glass: rgba(255,255,255,0.03);
      --shadow: 0 6px 18px rgba(2,6,23,0.6);
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0}
    body{
      display:flex;align-items:center;justify-content:center;
      background:linear-gradient(180deg,#021124 0%, #071225 100%);
      color: #e6eef8; padding:32px;
    }
    .calculator{
      width:360px; max-width:94vw; border-radius:18px; padding:18px; background:linear-gradient(180deg,var(--panel),#0b1220);
      box-shadow:var(--shadow);
    }
    .screen{
      background:var(--glass); border-radius:12px; padding:16px; display:flex;flex-direction:column; gap:6px; margin-bottom:16px;
    }
    .memory-indicator{color:var(--muted); font-size:12px}
    .expression{color:var(--muted); font-size:14px; min-height:18px; text-align:right; word-break:break-all}
    .display{font-size:32px; font-weight:600; text-align:right;}

    .pad{display:grid;grid-template-columns:repeat(4,1fr); gap:10px}
    button{
      background:var(--btn); border:0; padding:18px; border-radius:12px; font-size:18px; color:var(--muted);
      box-shadow: 0 4px 10px rgba(2,6,23,0.45); cursor:pointer; transition:transform .06s ease, background .12s;
    }
    button:active{transform:translateY(2px)}
    button.operator{background:linear-gradient(180deg,#0b1220,#142233); color:var(--accent); font-weight:600}
    button.equal{background:linear-gradient(180deg,#06b6d4,#0891b2); color:#032; font-weight:700; font-size:20px}
    button.wide{grid-column:span 2}
    .small{font-size:14px}
    .muted{color:var(--muted); background:transparent}
    .top-row{display:flex;gap:8px;margin-bottom:8px}

    footer{margin-top:12px; text-align:center; color:var(--muted); font-size:12px}

    @media (max-width:420px){ .display{font-size:28px} button{padding:14px;font-size:16px} }
  </style>
</head>
<body>
  <main class="calculator" role="application" aria-label="Calculator">
    <div class="screen" id="screen">
      <div class="top-row">
        <div class="memory-indicator" id="mem"> </div>
        <div style="flex:1"></div>
        <div class="small muted" id="help">Esc = C · ← = backspace · Enter = =</div>
      </div>
      <div class="expression" id="expression"> </div>
      <div class="display" id="display">0</div>
    </div>

    <div class="pad">
      <button class="muted small" data-action="mc">MC</button>
      <button class="muted small" data-action="mr">MR</button>
      <button class="muted small" data-action="mplus">M+</button>
      <button class="muted small" data-action="mminus">M-</button>

      <button data-action="clear" class="small">C</button>
      <button data-action="back">⌫</button>
      <button data-action="percent">%</button>
      <button data-action="operator" data-value="/">÷</button>

      <button data-number="7">7</button>
      <button data-number="8">8</button>
      <button data-number="9">9</button>
      <button data-action="operator" data-value="*">×</button>

      <button data-number="4">4</button>
      <button data-number="5">5</button>
      <button data-number="6">6</button>
      <button data-action="operator" data-value="-">−</button>

      <button data-number="1">1</button>
      <button data-number="2">2</button>
      <button data-number="3">3</button>
      <button data-action="operator" data-value="+">+</button>

      <button data-action="negate">±</button>
      <button data-number="0">0</button>
      <button data-action="decimal">.</button>
      <button class="equal" data-action="equals">=</button>
    </div>

    <footer>Single-file HTML/CSS/JS calculator — keyboard & memory support</footer>
  </main>

  <script>
    (function(){
      const display = document.getElementById('display');
      const expressionEl = document.getElementById('expression');
      const memEl = document.getElementById('mem');

      let expression = ''; // expression built so far, e.g. "2+3*"
      let current = '';    // current number being typed, e.g. "4.5"
      let memory = 0;
      let lastWasEquals = false;

      function render(){
        expressionEl.textContent = expression;
        display.textContent = (current === '' ? '0' : current);
        memEl.textContent = memory !== 0 ? 'M' : '';
      }

      function inputNumber(n){
        if(lastWasEquals){ expression = ''; lastWasEquals = false; current = n; render(); return; }
        // avoid leading zeros like "00"
        if(current === '0') current = n;
        else current = current + n;
        render();
      }

      function inputDecimal(){
        if(lastWasEquals){ expression = ''; lastWasEquals = false; current = '0.'; render(); return; }
        if(current === '') current = '0.';
        else if(!current.includes('.')) current += '.';
        render();
      }

      function applyOperator(op){
        lastWasEquals = false;
        if(expression === '' && current === ''){
          // nothing to apply
          return;
        }
        if(/[+\-*/]$/.test(expression)){
          // expression currently ends with an operator
          if(current !== ''){
            // append the typed number then replace operator
            expression = expression + current + op;
          } else {
            // just replace operator
            expression = expression.slice(0,-1) + op;
          }
        } else {
          // append current (if any) then operator
          expression = expression + (current === '' ? '' : current) + op;
        }
        current = '';
        render();
      }

      function clearAll(){ expression = ''; current = ''; lastWasEquals = false; render(); }

      function backspace(){
        if(lastWasEquals){ clearAll(); return; }
        if(current.length > 0){ current = current.slice(0,-1); }
        else if(expression.length > 0){
          if(/[+\-*/]$/.test(expression)) expression = expression.slice(0,-1);
          else expression = expression.replace(/\d+(?:\.\d+)?$|\)$/,'');
        }
        render();
      }

      function negate(){
        if(current === '') current = '0';
        if(current.startsWith('-')) current = current.slice(1);
        else current = '-' + current;
        render();
      }

      function percent(){
        let num = parseFloat(current || '0');
        num = num / 100;
        current = String(num);
        render();
      }

      function safeEval(expr){
        expr = expr.replace(/×/g,'*').replace(/÷/g,'/');
        if(!/^[0-9+\-*/().\s]+$/.test(expr)) throw new Error('Invalid characters');
        expr = expr.replace(/\s+/g,'');
        expr = expr.replace(/[+\-*/]+$/,''); // strip trailing operator if any
        return Function('return ('+expr+')')();
      }

      function equals(){
        try{
          let full = '';
          if(expression === '' && current === ''){
            full = '0';
          } else if(expression === ''){
            full = current;
          } else if(/[+\-*/]$/.test(expression)){
            if(current !== '') full = expression + current;
            else full = expression.slice(0,-1); // strip trailing operator
          } else {
            full = expression + (current === '' ? '' : current);
          }

          const result = safeEval(full);
          current = String(result);
          expression = '';
          lastWasEquals = true;
          render();
        }catch(e){
          current = 'Error';
          expression = '';
          lastWasEquals = true;
          render();
        }
      }

      // Memory functions
      function memClear(){ memory = 0; render(); }
      function memRecall(){ current = String(memory); render(); }
      function memAdd(){ memory = Number(memory) + Number(current || 0); render(); }
      function memSubtract(){ memory = Number(memory) - Number(current || 0); render(); }

      // wire buttons
      document.querySelectorAll('button').forEach(btn => {
        btn.addEventListener('click', ()=>{
          const n = btn.getAttribute('data-number');
          const action = btn.getAttribute('data-action');
          const op = btn.getAttribute('data-value');
          if(n) inputNumber(n);
          else if(action === 'decimal') inputDecimal();
          else if(action === 'clear') clearAll();
          else if(action === 'back') backspace();
          else if(action === 'negate') negate();
          else if(action === 'percent') percent();
          else if(action === 'equals') equals();
          else if(action === 'operator') applyOperator(op);
          else if(action === 'mc') memClear();
          else if(action === 'mr') memRecall();
          else if(action === 'mplus') memAdd();
          else if(action === 'mminus') memSubtract();
        });
      });

      // keyboard support
      window.addEventListener('keydown', (e)=>{
        if(e.key >= '0' && e.key <= '9') { inputNumber(e.key); e.preventDefault(); }
        else if(e.key === '.') { inputDecimal(); e.preventDefault(); }
        else if(e.key === 'Enter' || e.key === '=') { equals(); e.preventDefault(); }
        else if(e.key === 'Backspace') { backspace(); e.preventDefault(); }
        else if(e.key === 'Escape') { clearAll(); e.preventDefault(); }
        else if(e.key === '%') { percent(); e.preventDefault(); }
        else if(['+','-','*','/'].includes(e.key)){ applyOperator(e.key); e.preventDefault(); }
      });

      // init
      render();
    })();
  </script>
</body>
</html>
